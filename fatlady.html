<html>
<head>
<style>
.fullscreen-bg {
    position: fixed;
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
    overflow: hidden;
    z-index: -100;
}

.fullscreen-bg__video {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<script>

var action = {
      0:[0,1,2],
      1:[0,1,2],
      2:[3],
      3:[0,1,2]
  };
var eventNode = [1,2];
var currentNode =0;
function getNextNode(){
    var possibility=action[""+currentNode];
    console.log("Mi trovo in "+currentNode+"ho ben "+possibility+" ovvero ho "+possibility.length+" scelte");
    var p= parseInt(Math.random()*possibility.length);
    console.log(p);
    var chose = possibility[p];
    currentNode = chose;
    return chose;
}

$(document).ready(function(){
    var video=[];
    video[0] = document.getElementById('video0');
    video[1] = document.getElementById('video1');

    function prepareNextVideo(idxVideo,source,time){
      setTimeout(function() {

        var p= getNextNode();
        var src= "video/"+p+".avi";
         $(source).attr("src",src)

          video[idxVideo].load();
          video[idxVideo].play();
          /*$("#video"+(idxVideo)).show();
          $("#video"+(idxVideo+1)%2).hide();*/
      }, time);
    }
    /*var source = document.createElement('source');*/

    $("#video0").html('<source id="v0" src="video/0.avi" type="video/mp4">');
    $("#video1").html('<source id="v1" src="" type="video/mp4">');

    var i=0;
    $("#video0").on('playing',function(){
      $("#video0").show();
      $("#video1").hide();
      var duration=video[0].duration;
      console.log("duration is "+duration);
      prepareNextVideo(1,'#v1',duration*1000-200);
    });
    $("#video1").on('playing',function(){
      $("#video1").show();
      $("#video0").hide();
      var duration=video[1].duration;
      console.log("duration is "+duration);
      prepareNextVideo(0,'#v0',duration*1000-200);
    });


    //$("#video").on('ended',function(){
    //});


    var connection = new WebSocket("ws://localhost:8000/websocketserver");
    // When the connection is open, send some data to the server
    connection.onopen = function () {
      connection.send('Ping'); // Send the message 'Ping' to the server
    };

    // Log errors
    connection.onerror = function (error) {
      console.log('WebSocket Error ' + error);
    };

    // Log messages from the server
    connection.onmessage = function (e) {
      console.log('Server: ' + e.data);
    };
});
</script>

</head>
<body>
    <div class="fullscreen-bg">
      <!-- loop -->
        <video id="video0" muted autoplay class="fullscreen-bg__video">
        <!-- <source src="videoe/video1.avi" type="video/mp4"> -->
        Your browser does not support the video tag.
        </video>
        <video id="video1" muted autoplay class="fullscreen-bg__video">
        <!-- <source src="videoe/video1.avi" type="video/mp4"> -->
        Your browser does not support the video tag.
        </video>
    </div>
</body>
</html>
